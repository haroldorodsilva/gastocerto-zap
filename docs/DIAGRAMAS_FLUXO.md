# ðŸ”„ Diagramas de Fluxo - Sistema Multi-Contas

## ðŸ“Š Arquitetura Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USUÃRIO                             â”‚
â”‚              (WhatsApp / Telegram)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TransactionsService                        â”‚
â”‚                    (Orchestrator)                           â”‚
â”‚  â€¢ Recebe mensagens                                         â”‚
â”‚  â€¢ Analisa intenÃ§Ã£o (IntentAnalyzer)                       â”‚
â”‚  â€¢ Roteia para serviÃ§o especializado                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚           â”‚           â”‚           â”‚
          â–¼           â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Account    â”‚ â”‚ Regist. â”‚ â”‚ Listing â”‚ â”‚   Payment    â”‚
â”‚ Management  â”‚ â”‚ Service â”‚ â”‚ Service â”‚ â”‚   Service    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚              â”‚           â”‚              â”‚
      â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                          â”‚
      â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UserCache      â”‚    â”‚  GastoCerto API      â”‚
â”‚  â€¢ activeAccId  â”‚    â”‚  â€¢ createTransaction â”‚
â”‚  â€¢ accounts[]   â”‚    â”‚  â€¢ listTransactions  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ¦ Fluxo: Listar Contas

```
Usuario                TransactionsService      AccountManagement      UserCache
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚â”€â”€â”€ "minhas contas" â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚â”€â”€â”€â”€ analyzeIntent â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                            â”‚<â”€â”€â”€â”€ LIST_ACCOUNTS â”€â”€â”€â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚â”€â”€â”€â”€ listUserAccounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚<â”€ listAccounts â”€â”€â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚  [Account 1]     â”‚
  â”‚                            â”‚                        â”‚  [Account 2]     â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚<â”€â”€â”€ ðŸ¦ *Suas Contas:*      â”‚                        â”‚                  â”‚
  â”‚     âœ… 1. Pessoal          â”‚                        â”‚                  â”‚
  â”‚     âšª 2. PJ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
```

---

## ðŸ”„ Fluxo: Trocar Conta (Menu Interativo)

```
Usuario                TransactionsService      AccountManagement      UserCache
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚â”€â”€â”€ "mudar conta" â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚â”€â”€â”€â”€ switchAccount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚<â”€ listAccounts â”€â”€â”‚
  â”‚                            â”‚                        â”‚  [2 contas]      â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚<â”€â”€â”€ ðŸ¦ Menu numerado â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
  â”‚     1. Pessoal âœ…          â”‚                        â”‚                  â”‚
  â”‚     2. PJ âšª                â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚â”€â”€â”€ "2" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚â”€ isNumericSelection? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚â”€ selectAccountByNumber â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚â”€ switchAccount â”€>â”‚
  â”‚                            â”‚                        â”‚  (account-id-2)  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚<â”€â”€â”€ success â”€â”€â”€â”€â”€â”‚
  â”‚                            â”‚                        â”‚                  â”‚
  â”‚<â”€â”€â”€ âœ… Conta alterada â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
  â”‚     para: PJ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                  â”‚
  â”‚                            â”‚                        â”‚                  â”‚
```

---

## ðŸ’° Fluxo: Registrar TransaÃ§Ã£o

```
Usuario          TransactionsService    RegistrationService   AccountManagement   UserCache   API
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚â”€ "Gastei R$ 100" â”€â”€â”€>â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚â”€ processTextMessage â”€>â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚â”€ validateAccount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚<â”€ getActive â”€â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚  Account     â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚<â”€ {valid, accId} â”€â”€â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚â”€ extractTransaction (AI) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚<â”€ {valor, categoria} â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚<â”€ ðŸ”„ Confirme: â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚              â”‚         â”‚
  â”‚   R$ 100            â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚   Conta: PJ â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚â”€â”€â”€ "sim" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚â”€ processConfirmation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚     (com accountId da conta ativa)         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ success â”€â”€â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚<â”€ âœ… Registrado! â”€â”€â”€â”€â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚   em PJ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                    â”‚              â”‚         â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚         â”‚
```

---

## ðŸ” Fluxo: ValidaÃ§Ã£o Sem Conta Ativa

```
Usuario          TransactionsService    RegistrationService   AccountManagement   UserCache
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚â”€ "Gastei R$ 50" â”€â”€â”€â”€>â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚â”€ processTextMessage â”€>â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚â”€ validateAccount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚                    â”‚<â”€ getActive â”€â”‚
  â”‚                      â”‚                       â”‚                    â”‚   (null)     â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚<â”€ {valid: false} â”€â”€â”‚              â”‚
  â”‚                      â”‚                       â”‚   message: "..."   â”‚              â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚<â”€â”€â”€â”€ BLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
  â”‚<â”€ âš ï¸ VocÃª nÃ£o â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                    â”‚              â”‚
  â”‚   tem conta ativa â”€â”€â”‚                       â”‚                    â”‚              â”‚
  â”‚                      â”‚                       â”‚                    â”‚              â”‚
```

---

## ðŸš« Fluxo: Bloqueio de ConfirmaÃ§Ã£o Pendente

```
Usuario          TransactionsService    ConfirmationService
  â”‚                      â”‚                       â”‚
  â”‚â”€ "Gastei R$ 100" â”€â”€â”€>â”‚                       â”‚
  â”‚                      â”‚                       â”‚
  â”‚                      â”‚<â”€ getPending() â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚   (confirmacao-1)     â”‚
  â”‚                      â”‚                       â”‚
  â”‚<â”€ â¸ï¸ VocÃª tem â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚   confirmaÃ§Ã£o â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚   pendente! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚                      â”‚                       â”‚
  â”‚â”€ "Gastei R$ 50" â”€â”€â”€â”€>â”‚                       â”‚
  â”‚                      â”‚                       â”‚
  â”‚                      â”‚<â”€ getPending() â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚   (confirmacao-1)     â”‚
  â”‚                      â”‚                       â”‚
  â”‚<â”€ â¸ï¸ Ainda tem â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚   pendente! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
  â”‚                      â”‚                       â”‚
  â”‚â”€â”€â”€ "nÃ£o" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
  â”‚                      â”‚                       â”‚
  â”‚                      â”‚â”€â”€â”€ cancel() â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚                       â”‚
  â”‚<â”€ âŒ Cancelada â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚                       â”‚
  â”‚â”€ "Gastei R$ 50" â”€â”€â”€â”€>â”‚                       â”‚
  â”‚                      â”‚                       â”‚
  â”‚                      â”‚<â”€ getPending() â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚   (null)              â”‚
  â”‚                      â”‚                       â”‚
  â”‚<â”€ Processando... â”€â”€â”€â”‚  âœ… LIBERADO          â”‚
  â”‚                      â”‚                       â”‚
```

---

## ðŸ“Š Fluxo: Listar TransaÃ§Ãµes com ValidaÃ§Ã£o

```
Usuario          TransactionsService    ListingService   AccountManagement   API
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚â”€ "minhas transaÃ§Ãµes" â”‚                     â”‚                â”‚              â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚â”€ analyzeIntent â”€â”€â”€â”€â”€â”‚                â”‚              â”‚
  â”‚                      â”‚<â”€ LIST_TRANSACTIONS â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚â”€ listTransactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚â”€ validateActive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚<â”€ {valid, id} â”€â”‚              â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚â”€ API.list(accountId) â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚<â”€ [transaÃ§Ãµes da conta PJ] â”€â”€â”€â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
  â”‚<â”€ ðŸ“‹ TransaÃ§Ãµes PJ â”€â”€â”‚                     â”‚                â”‚              â”‚
  â”‚   [lista filtrada] â”€â”€â”‚                     â”‚                â”‚              â”‚
  â”‚                      â”‚                     â”‚                â”‚              â”‚
```

---

## ðŸ”€ Fluxo Completo: MÃºltiplas Contas

```
Estado Inicial:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserCache                        â”‚
â”‚ activeAccountId: "account-1"     â”‚
â”‚ accounts: [                      â”‚
â”‚   {id: "account-1", name: "Pes"} â”‚
â”‚   {id: "account-2", name: "PJ"}  â”‚
â”‚ ]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AÃ§Ã£o 1: Usuario envia "minhas contas"
        â†“
Resultado: Lista com indicadores âœ…/âšª

AÃ§Ã£o 2: Usuario envia "usar PJ"
        â†“
Estado Atualizado:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserCache                        â”‚
â”‚ activeAccountId: "account-2" â† mudou
â”‚ accounts: [                      â”‚
â”‚   {id: "account-1", name: "Pes"} â”‚
â”‚   {id: "account-2", name: "PJ"}  â”‚
â”‚ ]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AÃ§Ã£o 3: Usuario envia "Gastei R$ 100"
        â†“
ValidaÃ§Ã£o: getActiveAccount() â†’ "account-2"
        â†“
API: createTransaction(accountId: "account-2")
        â†“
Resultado: TransaÃ§Ã£o registrada em PJ âœ…

AÃ§Ã£o 4: Usuario envia "usar Pessoal"
        â†“
Estado Atualizado:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserCache                        â”‚
â”‚ activeAccountId: "account-1" â† mudou
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AÃ§Ã£o 5: Usuario envia "minhas transaÃ§Ãµes"
        â†“
API: listTransactions(accountId: "account-1")
        â†“
Resultado: Apenas transaÃ§Ãµes da conta Pessoal
```

---

## ðŸŽ¯ Pontos CrÃ­ticos de ValidaÃ§Ã£o

### âœ… SEMPRE validar antes de:
1. **Registrar transaÃ§Ã£o** â†’ `validateActiveAccount()`
2. **Listar transaÃ§Ãµes** â†’ `validateActiveAccount()`
3. **Pagar contas** â†’ `validateActiveAccount()`

### âœ… SEMPRE usar:
- `UserCache.getActiveAccount()` â†’ pegar conta ativa
- `UserCache.switchAccount(id)` â†’ trocar conta
- `UserCache.listAccounts()` â†’ listar todas

### âŒ NUNCA:
- Buscar "conta default" da API
- Assumir que usuÃ¡rio tem conta ativa
- Permitir operaÃ§Ã£o sem validaÃ§Ã£o

---

## ðŸ“ˆ MÃ©tricas de Sucesso

### Teste passou se:
âœ… Listagem mostra indicador correto (âœ… vs âšª)  
âœ… Troca de conta atualiza `activeAccountId`  
âœ… TransaÃ§Ã£o registrada na conta ativa  
âœ… Listagem filtra por conta ativa  
âœ… ValidaÃ§Ã£o bloqueia sem conta ativa  
âœ… SeleÃ§Ã£o numÃ©rica funciona (1, 2, 3)  

### Teste falhou se:
âŒ TransaÃ§Ã£o vai para conta errada  
âŒ Listagem mistura contas  
âŒ Troca de conta nÃ£o persiste  
âŒ ValidaÃ§Ã£o nÃ£o bloqueia  
âŒ Menu nÃ£o aceita nÃºmero  
